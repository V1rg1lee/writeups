# Challenge description

You know, we've tried a lot of things for the CSCBE, sometimes to make it easier on us,
sometimes to make it funner to play, sometimes, to avoid spelling mistakes like "Funner".

One idea I had one very, very late night, alone, was to have way more goodie variety.
Anything from socks to caps to underwear to headbands to gloves, and everything in between!

I have to be ashamed to admit it, I used AI to make all of it, and, as so often happens,
it turned against me. All the stock is gone, all that's left are flags.

Oh well, I still have this sheet of coupons, maybe one of them will work for you?

# Soluce

There is a PNG file: [coupons.png](media/coupons.png). On it there is are a lot of QR codes. Let's decode them.

```json
Raw text	

{"item":"Dress","quantity":"1","check":"4d59a442b89b87717aaf15d08a38a4b1"}

Raw bytes	

71 a4 4a 7b 22 69 74 65   6d 22 3a 22 44 72 65 73
73 22 2c 22 71 75 61 6e   74 69 74 79 22 3a 22 31
22 2c 22 63 68 65 63 6b   22 3a 22 34 64 35 39 61
34 34 32 62 38 39 62 38   37 37 31 37 61 61 66 31
35 64 30 38 61 33 38 61   34 62 31 22 7d 00 ec 11

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Dress","quantity":"1","check":"4d59a442b89b87717aaf15d08a38a4b1"}

Raw text	

{"item":"Beret","quantity":"1","check":"76cf0b3291431f2af4be30b13dcdc7b6"}

Raw bytes	

71 a4 4a 7b 22 69 74 65   6d 22 3a 22 42 65 72 65
74 22 2c 22 71 75 61 6e   74 69 74 79 22 3a 22 31
22 2c 22 63 68 65 63 6b   22 3a 22 37 36 63 66 30
62 33 32 39 31 34 33 31   66 32 61 66 34 62 65 33
30 62 31 33 64 63 64 63   37 62 36 22 7d 00 ec 11

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Beret","quantity":"1","check":"76cf0b3291431f2af4be30b13dcdc7b6"}

Raw text	

{"item":"Parka","quantity":"1","check":"55696509eaf3eb85f80c42fbe0b70b73"}

Raw bytes	

71 a4 4a 7b 22 69 74 65   6d 22 3a 22 50 61 72 6b
61 22 2c 22 71 75 61 6e   74 69 74 79 22 3a 22 31
22 2c 22 63 68 65 63 6b   22 3a 22 35 35 36 39 36
35 30 39 65 61 66 33 65   62 38 35 66 38 30 63 34
32 66 62 65 30 62 37 30   62 37 33 22 7d 00 ec 11

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Parka","quantity":"1","check":"55696509eaf3eb85f80c42fbe0b70b73"}

Raw text	

{"item":"Cap","quantity":"1","check":"8417965577df8da2ca473aac2503a733"}

Raw bytes	

71 a4 48 7b 22 69 74 65   6d 22 3a 22 43 61 70 22
2c 22 71 75 61 6e 74 69   74 79 22 3a 22 31 22 2c
22 63 68 65 63 6b 22 3a   22 38 34 31 37 39 36 35
35 37 37 64 66 38 64 61   32 63 61 34 37 33 61 61
63 32 35 30 33 61 37 33   33 22 7d 00 ec 11 ec 11

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Cap","quantity":"1","check":"8417965577df8da2ca473aac2503a733"}

Raw text	

{"item":"Socks","quantity":"1","check":"0e475bd82722955da9fba1e2d19966c6"}

Raw bytes	

71 a4 4a 7b 22 69 74 65   6d 22 3a 22 53 6f 63 6b
73 22 2c 22 71 75 61 6e   74 69 74 79 22 3a 22 31
22 2c 22 63 68 65 63 6b   22 3a 22 30 65 34 37 35
62 64 38 32 37 32 32 39   35 35 64 61 39 66 62 61
31 65 32 64 31 39 39 36   36 63 36 22 7d 00 ec 11

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Socks","quantity":"1","check":"0e475bd82722955da9fba1e2d19966c6"}

Raw text	

{"item":"Slippers","quantity":"1","check":"e19a9fa05918c9fe39b2e46e3a59dd9e"}

Raw bytes	

71 a4 4d 7b 22 69 74 65   6d 22 3a 22 53 6c 69 70
70 65 72 73 22 2c 22 71   75 61 6e 74 69 74 79 22
3a 22 31 22 2c 22 63 68   65 63 6b 22 3a 22 65 31
39 61 39 66 61 30 35 39   31 38 63 39 66 65 33 39
62 32 65 34 36 65 33 61   35 39 64 64 39 65 22 7d
00 ec 11 ec 11 ec 11 ec   11 ec 11 ec 11 ec 11 ec
11 ec 11 ec 11 ec 11 ec   11 ec 11 ec 

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Slippers","quantity":"1","check":"e19a9fa05918c9fe39b2e46e3a59dd9e"}

Raw text	

{"item":"T-Shirt","quantity":"","check":"2ff227989aa79adad4352223e419a145"}

Raw bytes	

71 a4 4b 7b 22 69 74 65   6d 22 3a 22 54 2d 53 68
69 72 74 22 2c 22 71 75   61 6e 74 69 74 79 22 3a
22 22 2c 22 63 68 65 63   6b 22 3a 22 32 66 66 32
32 37 39 38 39 61 61 37   39 61 64 61 64 34 33 35
32 32 32 33 65 34 31 39   61 31 34 35 22 7d 00 ec

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"T-Shirt","quantity":"","check":"2ff227989aa79adad4352223e419a145"}

Raw text	

{"item":"Legging","quantity":"1","check":"0a6bee53d902b43c92e105016812fe51"}

Raw bytes	

71 a4 4c 7b 22 69 74 65   6d 22 3a 22 4c 65 67 67
69 6e 67 22 2c 22 71 75   61 6e 74 69 74 79 22 3a
22 31 22 2c 22 63 68 65   63 6b 22 3a 22 30 61 36
62 65 65 35 33 64 39 30   32 62 34 33 63 39 32 65
31 30 35 30 31 36 38 31   32 66 65 35 31 22 7d 00

Barcode format	QR_CODE
Parsed Result Type	TEXT
Parsed Result	

{"item":"Legging","quantity":"1","check":"0a6bee53d902b43c92e105016812fe51"}
```

When we open the website, we can see that there is a `Flag` item to buy. But we don't have a `Coupon` for it. Let's try to create one. We have to create a JSON file with the same format as the others, but with the `Flag` item. Let's try to understand what the `check` field is.

```sh
┌──(virgile㉿localhost)-[~/Téléchargements/CSCB]
└─$ hashid 4d59a442b89b87717aaf15d08a38a4b1                                                                                                                 
Analyzing '4d59a442b89b87717aaf15d08a38a4b1'
[+] MD2 
[+] MD5 
[+] MD4 
[+] Double MD5 
[+] LM 
[+] RIPEMD-128 
[+] Haval-128 
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 
[+] Skype 
[+] Snefru-128 
[+] NTLM 
[+] Domain Cached Credentials 
[+] Domain Cached Credentials 2 
[+] DNSSEC(NSEC3) 
[+] RAdmin v2.x 
```

This is probably an MD5 hash. Let's try to crack it with the following script: [crack.py](code/crack.py).

```sh
┌──(env)(virgile㉿localhost)-[~/Téléchargements/CSCB]
└─$ python crack.py /usr/share/wordlists/rockyou.txt                                                                                                        
Searching for the secret for MD5 hash: 4d59a442b89b87717aaf15d08a38a4b1
Using dictionary file: /usr/share/wordlists/rockyou.txt
------------------------------------------------------------
Secret found: 
Concatenation used: 1Dress
```

The script try to concataine the quantity, the item and a secret in different ways and hash it. The result is `1Dress`, so there is no secret. Now we can create the `check` field by concatenating the quantity and the Flag item.

```sh
┌──(env)(virgile㉿localhost)-[~/Téléchargements/CSCB]
└─$ echo -n "1Flag" | md5sum                                                                                                                                
6afad76d43d37615347face200910f8c  
```

So the payload is:

```json
{"item":"Flag","quantity":"1","check":"6afad76d43d37615347face200910f8c"}
```

By analyzing the website, we can see that there is a `/order` route with a json with 3 fields:
- `products`: a list of products (here `["Flag"]`)
- `scannedData`: the scanned QR code (here our JSON) 
- `teamName`: the team name (here my team: `FireWaffles`)

We can send it with the following script: [send.py](code/send.py).

We get the following response:

```sh
┌──(env)(virgile㉿localhost)-[~/Téléchargements]
└─$ python coupon.py 
Thank you, team 'FireWaffles'! We have received your order, and will soon reach out to you. The challenge is over, we're actually going to bring you the flag in person. Because it's funny.
```

Here is the ticket I received:

![alt text](media/image.png)

So the flag is `CSC{WH04_YoU_M34N_wE_C4N_G37_1T?!}`.